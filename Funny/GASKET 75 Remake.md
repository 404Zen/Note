# 目标
制作一个支持罗技优联，USB连接的双模、热插拔 机械键盘。

键盘来自VGN N75，此部分取结构件(一个Gasket75的标准键盘，尝试重新Layout PCB, 暂时没有相关图纸)。
优联主控来自罗技。
USB部分准备自己写，先做硬件，软件可能会鸽(鸽了这个功能就没有了)。
背光部分其实也是可以做的。

难点在于 编码器 部分如何实现 多媒体按键功能(需要极致省电)。

# Logitech wireless keyboard controller
实际上，罗技的键盘根据 MN 码进行主控区分，只要是MN码一样的键盘，则采用的是同一款主控。以下是一些比较有意义(支持优联)的型号：

| MN               | 特征                                           | 其他 | 对应键盘型号                    |     |
| ---------------- | ---------------------------------------------- | ---- | ------------------------------- | --- |
| Y-R0015          | 有大小写指示灯，有直接多媒体按键，接口是压条的 |      | K270(老版本)/K260               |     |
| Y-R0005          | 不详，但是可以使用FPC连接                      |      | K340(比较老 难买到)             |     |
| Y-RBN90(Y-R0053) | 不详                                           |      | K350                            |     |
| Y-R0009          | 不详                                           |      | K330                            |     |
| Y-R0012          | 带背光，有CapsLock?                            |      | K800(贵)/K540(不知道是否同一款) |     |
| Y-R0065          | 带背光，锂电供电电路                           |      | K800                            |     |
| Y-R0016          | 不详                                           |      | K750/K230/K240(PCB可能不一样)   |     |
| Y-R0022          | 非104键全功能                                  |      | K230(便宜)                      |     |
| Y-R0061          | 没有大小写指示灯，FPC连接，支持蓝牙            |      | K375S(容易买到)                 |     |
|                  |                                                |      |                                 |     |

比较容易买到的是 
Y-R0015 版本的 K270，购买时注意询问卖家是否支持优联。
K230也是，也要注意问卖家是否支持优联，新版本的K230也不支持优联。
还有就是K375S，相比以上两个略贵

因Y-R0015 版本的 K270 已经满足个人需求，其他版本的特点就没有做统计了。

### K270 版本之分
关于K270是否支持优联，有版本之分(早期版本支持，键盘底部有 优联雪花标志)：
**已知支持优联的版本(MN码)**
Y-R0015(有优联标)

**不支持优联的版本**
Y-R0042(没有优联标)




# K270参考(Y-R0015)
![](assert/Pasted%20image%2020230429204855.png)
TP14: XTAL_OUT
TP5: RESET
TP2: CSSIM?
TP9: MMOSI?
TP8: MSCK?
TP1: VMCU
TP4: GND
TP3: MMISO
TP7: ?
TP13: J1-11
TP12: J1-14
TP11: J1-15
TP10: J1-16

![](assert/Pasted%20image%2020230429204915.png)



![](assert/Pasted%20image%2020230429194547.png)

# K270测试
测试电压：3.22V
发射电流：1.87mA(Caps Off)，9.97mA(Caps On)
休眠电流：3uA, 会定时发送心跳包发送时电流峰值约500mA, 平均 1~3s 出现一次
Only Caps On：9.89mA

### 改版后的控制器测试
裸控制器，5~6uA 休眠电流


# 需要进行的工作

## K270主控改造
K270 的大小写指示灯是直接在主控板上的，不在J1端口上。
需要做一个转接板，将K270的 按键矩阵端口(J1), 大小写指示灯口，电源端口引出。

## USB 主控部分
MCU采用？
USB 接入后，如何关闭优联？(需要保证不能同时输入多个按键)。

## 充电管理
充电采用 TP5100。
低电指示：采用电压监控IC（POR IC）

## 编码器到多媒体按键的实现
采用一个低功耗单片机实现


# 实际遇到的坑
## 结构
结构无法还原原版(主要是几个螺丝孔的位置比较关键)
第一版用的是swillkb导出的布局图，这里导出的1U按键间距为750mil, 实际上键盘用的是748mil/19mm 的间距；第一版打样作废。


# 后记
这把键盘做到一半的时候，我的 MX Master2S 感觉没那么好用了，应该是想要换新的了。去看了一下 MX Master3S，发现罗技换了一个名为 Bolt 的接收器，并不兼容优联，然而支持 Bolt 的键盘最便宜也要 ￥189(230603)，接收器还要另购，也罢。

# 参考链接
https://post.smzdm.com/p/a99v4z57/ (K270)
https://post.smzdm.com/p/a6lrk07n/
https://www.mydigit.cn/forum.php?mod=viewthread&tid=159011
https://www.zhihu.com/tardis/bd/art/355026370?source_id=1001 

http://www.51hei.com/bbs/dpj-138011-1.html
https://post.smzdm.com/p/a25r4xen/
https://post.smzdm.com/p/a99v2k80/
https://oshwhub.com/qianseyue/k375s-104_copy (请勿使用这个开源工程直接打样)


# 工具网站
http://www.keyboard-layout-editor.com/#/
http://builder.swillkb.com/

https://www.zfrontier.com/lab/keyboardTester (按键测试)